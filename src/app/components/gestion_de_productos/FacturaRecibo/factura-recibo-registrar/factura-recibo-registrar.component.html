<div class="container-fluid mt-4">
  <div class="row">
    <!-- Columna izquierda: Lista de Ventas -->
    <div class="col-md-6 mb-4">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">Lista de Ventas</h5>
        </div>
        <div class="card-body">
          <!-- Filtro para mostrar ventas -->
          <select
            class="form-select mb-3"
            [(ngModel)]="filtroVenta"
            (change)="filtrarVentas()"
          >
            <option value="ultima">Mostrar última venta</option>
            <option value="todo">Mostrar todas las ventas</option>
          </select>

          <!-- Buscador para ventas -->
          <input
            type="text"
            class="form-control mb-3"
            placeholder="Buscar por nombre del vendedor..."
            [(ngModel)]="busquedaVentas"
            (input)="filtrarVentas()"
          />

          <!-- Tabla de ventas filtradas -->
          <div
            class="table-responsive"
            style="max-height: 400px; overflow-y: auto"
          >
            <table class="table table-bordered table-hover text-center mb-0">
              <thead class="table-primary">
                <tr>
                  <th>ID</th>
                  <th>Total (Bs)</th>
                  <th>Fecha</th>
                  <th>Vendedor</th>
                  <th>Sucursal</th>
                  <th>Acciones</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let venta of ventasMostradas">
                  <td>{{ venta.id }}</td>
                  <td>{{ venta.total | number: "1.2-2" }}</td>
                  <td>{{ venta.fecha | date: "dd/MM/yyyy HH:mm" }}</td>
                  <td>
                    {{ venta.vendedor.nombre }} {{ venta.vendedor.apellido }}
                  </td>
                  <td>{{ venta.sucursal.nombre }}</td>
                  <td>
                    <button
                      class="btn btn-sm btn-success"
                      (click)="generarFactura(venta)"
                    >
                      Generar Factura
                    </button>
                    <button
                      class="btn btn-sm btn-info"
                      (click)="generarRecibo(venta)"
                    >
                      Generar Recibo
                    </button>
                  </td>
                </tr>
                <tr *ngIf="ventasMostradas.length === 0">
                  <td colspan="6" class="text-muted text-center">
                    No hay ventas para mostrar.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna derecha: Formulario para registrar factura o recibo -->
    <div
      class="col-md-6"
      *ngIf="modoFormulario === 'factura' || modoFormulario === 'recibo'"
    >
      <div class="card">
        <!-- Cabecera -->
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">
            Generar {{ tipoDocumentoSeleccionado | titlecase }}
          </h5>
        </div>

        <!-- Cuerpo del formulario -->
        <div class="card-body">
          <!-- Encabezado con logo, título y fecha -->
          <div class="row mb-3 align-items-center">
            <div class="col-6">
              <img
                src="https://www.shutterstock.com/image-vector/vector-logo-carpentry-workshop-woodwork-600nw-2554072869.jpg"
                alt="Logo de la Empresa"
                class="img-fluid"
                style="max-width: 150px"
              />
            </div>
            <div class="col-6 text-end">
              <div style="display: inline-block; text-align: left">
                <h3 class="fw-bold text-center">Proforma</h3>
                <table
                  class="table table-bordered table-sm text-center mb-0"
                  style="width: 100%; font-size: 0.85rem"
                >
                  <thead class="table-primary">
                    <tr>
                      <th style="padding: 4px">Día</th>
                      <th style="padding: 4px">Mes</th>
                      <th style="padding: 4px">Año</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td style="padding: 4px">{{ fechaHoy | date: "dd" }}</td>
                      <td style="padding: 4px">
                        {{ fechaHoy | date: "MMMM" }}
                      </td>
                      <td style="padding: 4px">
                        {{ fechaHoy | date: "yyyy" }}
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Contacto -->
          <div class="mb-3 text-start">
            <i class="bi bi-whatsapp text-success"></i>
            <strong>CELL:</strong> +591 77777777 - 72937437
            <div>SUCURSALES: Sucursal 1, Sucursal 2</div>
          </div>

          <!-- Formulario de datos del cliente -->
          <form>
            <div class="form-group mb-3 text-start">
              <label for="nombre_cliente">Nombre del Cliente:</label>
              <input
                type="text"
                id="nombre_cliente"
                class="form-control"
                [(ngModel)]="nombre_cliente"
                name="nombre_cliente"
                required
              />
            </div>

            <div class="form-group mb-3 text-start">
              <label for="ci_nit">CI/NIT:</label>
              <input
                type="text"
                id="ci_nit"
                class="form-control"
                [(ngModel)]="ci_nit"
                name="ci_nit"
                required
              />
            </div>
          </form>

          <!-- Tabla de detalles -->
          <table class="table table-bordered text-center mb-0">
            <thead class="table-primary">
              <tr>
                <th style="width: 10%">CANT.</th>
                <th style="width: 50%">DETALLE</th>
                <th style="width: 20%">P/UNIT.</th>
                <th style="width: 20%">TOTAL</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of detallesVenta">
                <td>{{ item.cantidad_vendida }}</td>
                <td>
                  {{ item.producto.especie }} -
                  {{ item.producto.categoria.nombre }} -
                  {{ item.producto.ancho }}x{{ item.producto.espesor }}x{{
                    item.producto.largo
                  }}
                </td>
                <td>{{ item.precio_unitario }}</td>
                <td>{{ item.subtotal }}</td>
              </tr>
            </tbody>

            <!-- Total alineado a la columna de TOTAL -->
            <tfoot *ngIf="ventaSeleccionada">
              <tr>
                <td colspan="3" class="text-end"><strong>TOTAL Bs.</strong></td>
                <td>
                  <strong
                    >{{ ventaSeleccionada.total | number: "1.2-2" }} Bs</strong
                  >
                </td>
              </tr>
            </tfoot>
          </table>

          <!-- Botones de acción -->
          <div class="d-flex justify-content-between mt-3">
            <button class="btn btn-primary" (click)="guardarDocumento()">
              Guardar Documento
            </button>
            <button class="btn btn-secondary" (click)="cancelarFormulario()">
              Cancelar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
